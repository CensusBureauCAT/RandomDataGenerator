<!DOCTYPE html>
<html>
<head lang="en">

    <!-- Metadata -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Random Data Generator">
    <meta name="author" content="David Lee">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" >
    <!-- Stylesheets -->

    <!-- Bootstrap -->
    <link href="bootstrap-3.3.2-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- JSX Graph -->
    <link href="JSXGraph/jsxgraph.css" rel="stylesheet">
    <!-- JQuery UI -->
    <link href="jquery-ui-1.11.4/jquery-ui.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">-->
    <!-- Draggable Table Plugin -->
    <link href="dragtable-2.0.12/dragtable.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="random-number-generator-stylesheet.css" rel="stylesheet">

    <title></title>

    <!-- Javascript Libraries -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery-1.11.2.min.js"></script>
    <!-- Random data generator -->
    <script src="chance.js"></script>
    <!-- Papa Parse csv generator -->
    <script src="PapaParse-4.1.0/papaparse.min.js"></script>
    <!-- JSX Graph -->
    <script src="JSXGraph/jsxgraphcore.js"></script>
    <!-- JQuery UI -->
    <script src="jquery-ui-1.11.4/jquery-ui.js"></script>
    <!-- Draggable Table Plugin -->
    <script src="dragtable-2.0.12/jquery.dragtable.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap-3.3.2-dist/js/bootstrap.min.js"></script>
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>-->


    <script src="http://www.parsecdn.com/js/parse-1.4.2.min.js"></script>

</head>

<body style="background-color: #E2CFB9">
<div class="container-fluid">

    <!-- Title -->
    <div class="row">
        <div class="col-sm-offset-3 col-sm-6" style="padding-top: 25px; padding-bottom: 25px">
            <h1 style="text-align: center;">Random Data Generator</h1>
        </div>
    </div>



    <!-- Front page config table used to set columns to your random data table -->
    <!-- Search for 'Section: config page code' for code -->
    <div id="configPage">


        <!-- These dropdown menu imports and exports your data and settings -->
        <div class="row" style="padding-right: 10px; padding-bottom: 10px;">
            <div class="col-sm-offset-8 col-sm-1" style="justify-content: flex-end; display: flex">
                <span id="menu" class="glyphicon glyphicon-align-justify dropdown-toggle" onclick='$("#menuContainer").slideToggle()'></span>
            </div>
        </div>

        <!-- Button to import custom data from a CSV file.  No headers used -->
        <div id="menuContainer" class="row">
            <div class="col-sm-offset-3 col-sm-6" style="background-color: #ADC6E8; border-top-left-radius: 4px; border-top-right-radius: 4px; padding-top: 20px; padding-bottom: 20px">
                <div style="float:right;">
                    <table>
                        <tr style="padding-top: 10px;">
                            <td style="padding-right: 20px">
                                <div style="border-style: solid; border-width: 2px; border-radius: 4px;
                        border-color: #FAF0E8; height: 80px; width: 200px;  padding: 4px; padding-left: 15px; background-color: #E2CFB9">
                                    <div style="width: 200px;">Load Source Data and</br>Settings
                                        <input id="loadFileItem" type="file" class="btn btn-default"
                                               onchange="loadSettings()" style="padding: 10px; width:110px;  display: inline;">
                                    </div>
                                </div>

                            </td>
                            <td>
                                <div style="border-style: solid; border-width: 2px; border-radius: 4px;
                    border-color: #FAF0E8;  height: 80px; width: 200px; padding: 4px;  padding-left: 15px; justify-content: center; display: flex; background-color: #E2CFB9">
                                    <div style="width: 200px;">Save Source Data and</br>Settings
                                        <a class="btn btn-default" onclick="saveSettings(this)">Click to Save</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-sm-offset-3 col-sm-6"
                 style="border: 1px solid lightgray; border-radius: 4px; box-shadow: 1px 2px 2px 2px #888888;">

                <!-- This table is used to set columns to your random data table  -->
                <table id="configTable" class="table table-hover">
                    <col style="width:10%">
                    <col style="width:38%">
                    <col style="width:20%">
                    <col style="width:10%">
                    <col style="width:22%">


                    <thead>
                    <tr>
                        <th>Order</th>
                        <th>Column Title</th>
                        <th>Data Type</th>
                        <th>Delete</th>
                        <th>Edit Data Source and Weight Distribution</th>
                    </tr>
                    </thead>

                    <tbody id="configTableBody">

                        <!-- Two default columns to get the user started.  -->
                        <!-- Used to test the code before updating the addNewRow() function -->
                        <tr class="edit-table-item" style="width: 100%">
                            <!-- The order the columns get generated in the table -->
                            <td class="order" style="text-align: center">1</td>
                            <!-- Column title -->
                            <td>
                                <input class="form-control columnTitle" type="text" style="width: 200px"/></td>
                            </td>
                            <!-- Data type selection -->
                            <td>
                                <!-- Single dropdown button -->
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                            aria-expanded="false" onclick="selectDataType(this)" style="width:100px;">
                                        Data Type <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#">Name</a></li>
                                        <li><a href="#">Address</a></li>
                                        <li><a href="#">State</a></li>
                                        <li><a href="#">Zip Code</a></li>
                                        <li><a href="#">Phone</a></li>
                                        <li><a href="#">SSN</a></li>
                                        <li><a href="#">Gender</a></li>
                                        <li><a href="#">Date</a></li>
                                        <li class="divider"></li>
                                        <li><a href="#">Number</a></li>
                                        <li class="divider"></li>
                                        <li><a href="#">Custom</a></li>
                                    </ul>
                                </div>
                            </td>
                            <!-- Delete button -->
                            <td class="deleteButtonContainer">
                                <button type="button" class="btn btn-default" onclick="deleteRow(this)">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            </td>
                            <!-- Change view button.  Brings in custom column editor.  Reuses deleteButtonContainer for styling -->
                            <td class="deleteButtonContainer">
                                <!-- Edit button -->
                                <button class="btn btn-default customButton"
                                        onclick="loadGraphPage($(this).parent().parent().children().first().text())"
                                        style="display:none;"
                                        >Edit</button>
                                <!-- Numbers min max range -->
                                <div class="numbersInput" style="display:none">
                                    <div class="input-group">
                                        <span class="input-group-addon" style="width: 60px">Min</span>
                                        <input type="number" class="form-control min" style="width: 60px" value="1">
                                    </div>
                                    <div class="input-group" style="padding-top: 10px">
                                        <span class="input-group-addon" style="width: 60px">Max</span>
                                        <input type="number" class="form-control max" style="width: 60px" value="10">
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Second default column -->
                        <tr class="edit-table-item" style="width: 100%">
                            <!-- The order the columns get generated in the table -->
                            <td class="order" style="text-align: center">2</td>
                            <!-- Column title -->
                            <td>
                                <input class="form-control columnTitle" type="text" style="width: 200px"/></td>
                            </td>
                            <!-- Data type selection -->
                            <td>
                                <!-- Single dropdown button -->
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                            aria-expanded="false" onclick="selectDataType(this)" style="width:100px;">
                                        Data Type <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><a href="#">Name</a></li>
                                        <li><a href="#">Address</a></li>
                                        <li><a href="#">State</a></li>
                                        <li><a href="#">Zip Code</a></li>
                                        <li><a href="#">Phone</a></li>
                                        <li><a href="#">SSN</a></li>
                                        <li><a href="#">Gender</a></li>
                                        <li><a href="#">Date</a></li>
                                        <li class="divider"></li>
                                        <li><a href="#">Number</a></li>
                                        <li class="divider"></li>
                                        <li><a href="#">Custom</a></li>
                                    </ul>
                                </div>
                            </td>
                            <!-- Delete button -->
                            <td class="deleteButtonContainer">
                                <button type="button" class="btn btn-default" onclick="deleteRow(this)">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </button>
                            </td>
                            <!-- Change view button.  Brings in custom column editor.  Reuses deleteButtonContainer for styling -->
                            <td class="deleteButtonContainer">
                                <!-- Edit button -->
                                <button class="btn btn-default customButton"
                                        onclick="loadGraphPage($(this).parent().parent().children().first().text())"
                                        style="display:none;"
                                        >Edit</button>
                                <!-- Numbers min max range -->
                                <div class="numbersInput" style="display:none">
                                    <div class="input-group">
                                        <span class="input-group-addon" style="width: 60px">Min</span>
                                        <input type="number" class="form-control min" style="width: 60px" value="1">
                                    </div>
                                    <div class="input-group" style="padding-top: 10px">
                                        <span class="input-group-addon" style="width: 60px">Max</span>
                                        <input type="number" class="form-control max" style="width: 60px" value="10">
                                    </div>
                                </div>
                            </td>
                        </tr>

                    </tbody>
                </table>

                <!-- Adds new row to the config table for random data table -->
                <div class="row" style="padding: 10px 20px;">
                    <div class="col-sm-offset-3 col-md-6" style="justify-content: center; display: flex">
                        <button type="button" class="btn btn-default" onclick="addNewRow()" >Add Row</button>
                    </div>
                </div>

            </div>
        </div>


        <!-- Link to export random data table to CSV file.  Does not include headers. -->
        <div id="exportLink" class="row" style="padding: 10px 20px; display:none">
            <div class="col-sm-offset-3 col-sm-6" style="justify-content: center; display: flex">
                <a href="#" class="export">Export generated data into CSV</a>
            </div>
        </div>


        <!-- Button to generate random data based off the config table from above -->
        <div class="row" style="padding: 10px 20px 2px 20px">
            <div class="col-sm-offset-3 col-sm-6" style="justify-content: center; display: flex">
                <button type="button" class="btn btn-sm" >Generate
                    <input type="number" id="numberGenerated" value=10 min="1" max="1000" style="text-align: center">
                    Rows
                </button>
                <button type="button" class="btn btn-default" onclick="generateTable()" >Generate</button>
            </div>
        </div>

        <!-- Input to set random seed -->
        <div class="row" style="padding: 2px 20px;">
            <div class="col-sm-offset-3 col-sm-6" style="justify-content: center; display: flex">
                <button type="button" class="btn btn-sm" >Random Seed
                    <input type="number" id="randomSeed" value=10 min="1" max="1000" style="text-align: center">
                </button>
            </div>
        </div>


        <!-- Random data table.  Populated once the button above is clicked -->
        <div class="row">
            <div id="generatedTable" class="col-sm-offset-3 col-sm-6">

            </div>
        </div>


    </div>




    <!-- Page for custom column editing -->
    <!-- Search for 'Section: graph page code' for code -->
    <div id="editSourceData" class="row" style="padding-top: 50px; height: 600px; display:none;">
        <div class="col-sm-offset-2 col-sm-4">

            <!-- Button to return back to the front page -->
            <div class="row" style="padding-bottom: 10px; padding-top: 10px">
                <button class="btn btn-default" onclick="loadConfigPage()">Return to Table</button>
            </div>

            <!-- Button to import custom data from a CSV file.  No headers used -->
            <div class="row" style="justify-content: center; display: flex; border: 1px solid #ddd; border-radius: 4px">
                <div class="col-sm-4">
                    Import CSV File
                    <!--<div style="justify-content: center; display: flex;  width: 300px;">
                        <input id="fileItem" type="file" onchange="importData()" style="padding: 10px;">
                    </div> -->
                    <input id="fileItem" type="file" onchange="importData()" style="padding: 10px; width:110px;">
                </div>
            </div>

            <!-- Adds some space between the two panels -->
            <div class="row" style="padding: 10px 20px; justify-content: center; display: flex;">

            </div>


            <!-- Custom column editor menu -->
            <div class="row" style="padding: 10px 20px; justify-content: center; display: flex;">
                <!-- Number of rows to add/set -->
                <div type="button" style="background-color: lightgray; border-radius: 4px; padding: 5px 10px 5px 10px" >
                    <!-- Button to add rows -->
                    <button type="button" class="btn btn-default" onclick="addGraphEntries()"
                            style="padding-top: 2px; padding-bottom: 2px" >Add</button>
                    <!-- Button to set rows -->
                    <button type="button" class="btn btn-default" onclick="setGraphEntries()"
                            style="padding-top: 2px; padding-bottom: 2px" >Set</button>

                    <input type="number" id="numberOfRowsToAdd" value="1" min="0" max="10000" style="text-align: center;
                    width: 60px;" onchange="checkNumberCurve()">
                            <!-- Type of data to fill each row -->
                            <!-- Single dropdown button -->
                            <span class="btn-group">
                                <button id="graphDataType" type="button" class=" dropdown-toggle"
                                        data-toggle="dropdown" aria-expanded="false" onclick="selectGraphDataType(this)"
                                        style="width:90px">Blank <span class="caret"></span></button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">Blank</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">Name</a></li>
                                    <li><a href="#">Address</a></li>
                                    <li><a href="#">State</a></li>
                                    <li><a href="#">Zip Code</a></li>
                                    <li><a href="#">Phone</a></li>
                                    <li><a href="#">SSN</a></li>
                                    <li><a href="#">Gender</a></li>
                                    <li><a href="#">Date</a></li>
                                    <li class="divider"></li>
                                    <li><a href="#">Numbers</a></li>
                                </ul>
                            </span>
                    <span>Unique Rows</span>
                </div>

            </div>
            <div class="row" id="numbersPanel" style="padding: 0px 0px 20px 0px; justify-content: center; display: flex;">
                <div type="button" style="background-color: lightgray; border-radius: 4px; padding: 5px 10px 5px 10px" >
                    Start<input type="number" id="start" value="1"
                                style="text-align: center; width: 40px; margin-left: 5px"
                                onchange="updateNumberCurve()">
                    Step<input type="number" id="step" value="1"
                               style="text-align: center; width: 40px; margin-left: 5px; margin-right: 5px"
                               onchange="updateNumberCurve()">
                    Function: y=<input type="text" id="function" value="x"
                                       style="width: 100px; margin-left: 5px" onchange="updateNumberCurve()">
                    <span id="question" class="question glyphicon glyphicon-question-sign"
                          data-toggle="tooltip"></span>
                </div>
            </div>

            <!-- Headers for the custom column editor -->
            <div class="row">
                <label style="padding-left: 35px">Name</label>
                <label style="float: right; padding-right: 25px">Delete</label>
                <label style="float: right; padding-right: 5px">Weight</label>
            </div>
            <div class="row">
                <!-- Custom column editor -->
                <div id="sourceList" class="list-group" style="overflow-y: auto; padding: 0px 20px 0px 20px">

                </div>
            </div>
        </div>



        <!-- The graph the used to set the weight distribution -->
        <!-- Search for 'Section: JXGGraph code' for code -->
        <div class="col-sm-4">

            <!-- The graph -->
            <div id="box" class="jxgbox" style="width:500px; height:500px;"></div>

            <!-- Button to calculate the points along the curve at the set intervals and set the custom column editor -->
            <div style="padding-top: 10px;">
                <label style="padding-right: 10px">Interval</label>
                <input id="interval" type="number" min="1" max="1000" style="text-align: center;" value="1">
                <button type="button" class="btn btn-default" onclick="setWeightCurveFromGraph()" >Set Weight Curve</button>
                <!-- Toggles between line and curve graph -->
                <span>  Line </span><input class="myCheckbox" type="checkbox" onclick="switchGraph()">
            </div>
        </div>



    </div>

</div>


<script>
    // Section: config page code
    // These are the functions for the config page (its the first page seen when loaded)

    // Hide load/save settings container
    $("#menuContainer").hide();

    // Hide buttons on config page (custom, numbers)
    $("#configTableBody tr td:nth-child(5) button").hide();
    $("#configTableBody tr td:nth-child(5) .numbersInput").hide();

    // Remove default text created next to load file button
    $('#loadFileItem').val("");

    // Used as test case for 3250000000 entries
    Parse.initialize("vv0wxFnw2CPn3hJwpNdHzIss3Wx7wsKyLTw3BMLA", "RmMDVcPMqPSDiMdA8CGFdwcvl71ksxt5Xpzwl7qd");


    // Set the default data for the two default rows. Also used when adding new rows.
    var customDefaultData = [
        {
            data:"Cras justo odio",
            weight: 1
        },
        {
            data: "Dapibus ac facilisis in",
            weight: 1
        },
        {
            data: "Morbi leo risus",
            weight: 1
        },
        {
            data: "Porta ac consectetur ac",
            weight: 1
        },
        {
            data: "Vestibulum at eros",
            weight: 1
        }
    ];

    var customGraphDataList = [$.extend(true, [], customDefaultData), $.extend(true, [], customDefaultData)];

    // This is used to return Graph Data back to array
    var customGraphDataIndex = 0;

    // Default graph points.  Also used when adding new rows.
    var customGraphPoints = [
        [
            {
                xCoords: 1,
                yCoords: 0,
                name: "Start"
            },
            {
                xCoords: 25,
                yCoords: 40,
                name: "A"
            },
            {
                xCoords: 50,
                yCoords: 0,
                name: "End"
            }
        ],
        [
            {
                xCoords: 1,
                yCoords: 0,
                name: "Start"
            },
            {
                xCoords: 25,
                yCoords: 40,
                name: "A"
            },
            {
                xCoords: 50,
                yCoords: 0,
                name: "End"
            }
        ]
    ];

    // Default settings to load when starting custom data editor page.  Also used when adding new rows.
    var customGraphSettings = [
        {
            interval: 1,
            line: false
        },
        {
            interval: 1,
            line: false
        }
    ];

    //-- Saves data and custom settings to saveData.txt
    function saveSettings(object) {

        var filename = "rdg_settings.txt";

        var numberOfRowsToSave = $("#configTable tbody tr").length;
        var rowsData = $("#configTable tbody tr");

        console.log(rowsData);

        var jsonString = '{ "data": [';

        rowsData.each(function(index) {
            var title = $(this).find("input.columnTitle").val();
            var dataType = $(this).find("button.dropdown-toggle").text();
            jsonString = jsonString +
                    '\n{\n"title": "' + title + '",' +
                    '\n"dataType": "' + dataType + '"';
            if (dataType == "Number ") {
                var min = $(this).find("input.min").val();
                var max = $(this).find("input.max").val();
                jsonString = jsonString +
                        ',\n"min": ' + min +
                        ',\n"max": ' + max + "\n}";
            }
            else if (dataType == "Custom ") {
                jsonString = jsonString +
                        ',\n"customData": ' + JSON.stringify(customGraphDataList[index]) +
                        ',\n"customPoints": ' + JSON.stringify(customGraphPoints[index]) +
                        ',\n"customSettings": ' + JSON.stringify(customGraphSettings[index]) + "\n}";
            } else {
                jsonString = jsonString + "\n}";
            }

            if (index != numberOfRowsToSave - 1) {
                jsonString = jsonString + ",\n";
            }
        });

        jsonString = jsonString + '\n],\n "seed:" ' + $("#randomSeed").val() +"}";

        // Data URI
        var fileData;

        fileData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(jsonString);
        console.log("JSON: " + jsonString);

        $(object)
                .attr({
                    'download': filename,
                    'href': fileData,
                    'target': '_blank'
                });

        console.log("Exported Settings");

        $("#menuContainer").slideToggle()
    }

    //-- Loads data and custom settings from txt file
    function loadSettings() {
        console.log("Starting load");
        var input, file, fr, newArr;

        if (typeof window.FileReader !== 'function') {
            alert("The file API isn't supported on this browser yet.");
            return;
        }

        input = document.getElementById('loadFileItem');
        if (!input) {
            alert("Couldn't find the loadFileItem element.");
        }
        else if (!input.files) {
            alert("This browser doesn't seem to support the `files` property of file inputs.");
        }
        else if (!input.files[0]) {
            alert("Please select a file before clicking 'Load'");
        }
        else {
            file = input.files[0];
            fr = new FileReader();
            fr.onload = receivedText;
            fr.readAsText(file);
        }

        function receivedText(e) {
            lines = e.target.result;
            newArr = JSON.parse(lines);
            console.log("Data file read as ");
            console.log(newArr);

            $("#randomSeed").val(newArr.seed);

            $("#configTableBody").html("");

            var numOfRowsToLoaded = newArr.data.length;
            console.log("Number of rows loaded: " + numOfRowsToLoaded);

            for (index in newArr.data) {
                var newTitle = newArr.data[index].title;
                var newDataType = newArr.data[index].dataType;

                addNewRow();
                var rowToBeEdited = $('#configTableBody tr').last();
                rowToBeEdited.find("input.columnTitle").val(newTitle);
                rowToBeEdited.find("button.dropdown-toggle").html(newDataType + '<span class="caret"></span>');


                if (newDataType == "Custom ") {
                    // Set custom data
                    customGraphDataList[index] = newArr.data[index].customData;
                    customGraphPoints[index] = newArr.data[index].customPoints;
                    customGraphSettings[index] = newArr.data[index].customSettings;
                    // Show custom data
                    rowToBeEdited.find(".customButton").show();
                } else if (newDataType == "Number ") {
                    // Set numbers data
                    var newMin = newArr.data[index].min;
                    var newMax = newArr.data[index].max;
                    rowToBeEdited.find("input.min").val(newMin);
                    rowToBeEdited.find("input.max").val(newMax);
                    // Show numbers data
                    rowToBeEdited.find(".numbersInput").show();
                }

            }

        }


        $('#loadFileItem').val("");
        $("#menuContainer").slideToggle()

    }

    //-- Updates the dropdown menu label and column name to the selection for the config table
    function selectDataType(object) {
        //console.log($(object).next().prop("tagName"));
        $(object).next().on('click', 'li a', function(){

            $(object).html($(this).text() + ' <span class="caret">');
            $(object).parent().parent().prev().find("input").val($(this).text());
            if ($(object).text() == "Custom ") {
                //console.log($(object).parent().parent().next().next().children().first().prop("tagName"));
                //$(object).parent().parent().next().next().children().first().css("visibility", "visible");
                // Fade Custom Button

                // Fade Numbers Buttons
                $(object).parent().parent().next().next().children().first().next().fadeOut("slow",
                        function() {$(object).parent().parent().next().next().children().first().fadeIn("slow");}
                );
            } else {
                //$(object).parent().parent().next().next().children().first().css("visibility", "hidden");

                if ($(object).text() == "Number ") {
                    $(object).parent().parent().next().next().children().first().fadeOut("slow",
                            function(){
                                $(object).parent().parent().next().next().children().first().next().fadeIn("slow")});
                } else {
                    $(object).parent().parent().next().next().children().first().fadeOut("slow",
                            function() {
                                $(object).parent().parent().next().next().children().first().next().fadeOut("slow")});
                }
            }
        });

    }

    // Goes to graph page from config page.  Used by a button.
    function loadGraphPage(index) {

        // Load data into custom data list

        $("#numbersPanel").hide();
        $("#numberOfRowsToAdd").val("1");
        $("#graphDataType").html("Blank" + ' <span class="caret">');

        console.log("Editing column " + index);
        index--; // Index begins at 0
        returnIndex = index;

        customGraphDataIndex = index;

        var customGraphData = customGraphDataList[index];

        $('#sourceList').html("");

        for (var count = 0; count < customGraphData.length; count++) {
            $('#sourceList').append(
                    '<table  style="width: 100%;" class="list-group-item">' +
                    '<tr style="width: 100%">' +
                    '<td class="list-group-td" contenteditable="true">' +
                    customGraphData[count].data +
                    '</td>' +
                    '<td class="weight-td">' +
                    '<div type="text" class="btn btn-default" contenteditable="true" >' +
                    customGraphData[count].weight +
                    '</div>' +
                    '</td>' +
                    '<td class="deleteButtonContainer">' +
                    '<button type="button" class="btn btn-default" onclick="deleteGraphEntry(this)">' +
                    '<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>' +
                    '</button>' +
                    '</td>' +
                    '</tr>' +
                    '</table>'
            )
        }


        // Load graph settings

        if (customGraphSettings[index].line) {
            console.log("line is true");
            $('.myCheckbox').prop('checked', true);
        } else {
            console.log("line is false");
            $('.myCheckbox').prop('checked', false);
        }

        $("#interval").val(customGraphSettings[index].interval);


        // Load points into graph

        console.log("Building " + customGraphPoints[index].length + " points into array");

        pointsArray = [];

        for (var i=0; i < customGraphPoints[index].length; i++) {
            initialPoint = board.create('point',
                    [customGraphPoints[index][i].xCoords,customGraphPoints[index][i].yCoords],
                    {name:customGraphPoints[index][i].name, size:4, snapToGrid: true});
            pointsArray.push(initialPoint);
            console.log("Added point to array");
        }

        console.log("Drawing " + pointsArray.length + " points on graph");

        // Draw curve or line graph depending on whether checkbox is checked
        if (!$('.myCheckbox').is(':checked')) {
            c = board.create('curve', JXG.Math.Numerics.CatmullRomSpline(pointsArray), {strokeWidth: 3});
        } else {
            lineList = [];

            // Draw a line graph
            for (arrayIndex in pointsArray) {
                //console.log("line list index " + arrayIndex);
                //console.log("Array length " + pointsArray.length);
                if ((parseInt(arrayIndex) + 1) == pointsArray.length) {
                    //console.log("Breaking line list at " + arrayIndex);
                    break;
                }
                var line = board.create('line', [pointsArray[parseInt(arrayIndex)], pointsArray[parseInt(arrayIndex) + 1]], {straightFirst:false, straightLast:false, strokeWidth:2});
                lineList.push(line);
            }
        }


        // Load the graph settings

        if (customGraphSettings[index].line) {
            $('.myCheckbox').attr('checked', true);
        } else {
            $('.myCheckbox').attr('checked', false);
        }

        $("#interval").val(customGraphSettings[index].interval);


        // Fade in created page
        $('#configPage').fadeOut(500,'linear', function() {$('#editSourceData').fadeIn(500)});
    }

    //-- Generates random data and creates the table
    function generateTable() {


        /*
        var j = 0,k = 0, l = 0, m = 0;
        var newString;
        for (i=0; i < 325000000; i++) {
            var TestObject = Parse.Object.extend("TestObject");
            var testObject = new TestObject();
            newString = i.toString();
            testObject.save({foo: newString}).then(function(object) {
                k++;
                if (k == 1000) {
                    k = 0;
                    m++;
                    console.log("Thousands Finished: " + m);
                }
                //console.log("Finished " + k);
            });
            j++;
            if (j == 1000) {
                j = 0;
                l++;
                console.log("Thousands sent: " +  l);
            }
            //console.log("Counting " + i);
        }
        console.log("Finished generating data");
        */

        /*
        $("#exportLink")
                .attr({
                    'download': 'test.csv',
                    'href': csvData,
                    'target': '_blank'
                });
        */
        /*
        console.log("Exporting");
        return;
        */

        $("#exportLink").slideDown();

        console.log("Start table generation");
        var chanceSeeded = new Chance(parseInt($("#randomSeed").val()));
        var tableData = [];
        var tableHeaders = [];
        var rowsGenerated = $("#numberGenerated").val();
        if (rowsGenerated < 0) {
            return;
        }

        // Generate the table headers
        for (var i=0; i < $("#configTableBody").children().length; i++) {
            tableHeaders.push($("#configTableBody input.columnTitle:eq(" + i + ")").val());
        }
        console.log("Headers:");
        console.log(tableHeaders);

        // Generate the table data based off the config settings
        for (var i=0; i < $("#configTableBody tr").length; i++) {
            //console.log(i);
            //console.log($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() + ".");
            if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Name ") {
                tableData[i] = chanceSeeded.n(chanceSeeded.name, rowsGenerated);
                console.log("Names generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Address ") {
                tableData[i] = chanceSeeded.n(chanceSeeded.address, rowsGenerated);
                console.log("Address generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "State ") {
                console.log("State generated");
                tableData[i] = chanceSeeded.n(chanceSeeded.state, rowsGenerated);
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Zip Code ") {
                tableData[i] = chanceSeeded.n(chanceSeeded.zip, rowsGenerated);
                console.log("Zip code generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Phone ") {
                tableData[i] = chanceSeeded.n(chanceSeeded.phone, rowsGenerated);
                console.log("Telephone generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "SSN ") {
                tableData[i] = chanceSeeded.n(chanceSeeded.ssn, rowsGenerated);
                console.log("SSN generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Gender ") {
                tableData[i] = chanceSeeded.n(chanceSeeded.gender, rowsGenerated);
                console.log("Gender generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Date ") {
                console.log("Date generated");
                function dateString() {
                    return chanceSeeded.date({string: true});
                }
                tableData[i] = chanceSeeded.n(dateString, rowsGenerated);
                tableData[i].sort();
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Number ") {
                console.log("Generating numbers data set");
                console.log("min:" + $("#configTableBody tr .numbersInput:eq(" + i + ") input:eq(0)").val());
                console.log("max:" + $("#configTableBody tr .numbersInput:eq(" + i + ")  input:eq(1)").val());
                function generateNumber () {
                    return chanceSeeded.integer({
                        min: parseInt($("#configTableBody tr .numbersInput:eq(" + i + ") input:eq(0)").val()),
                        max: parseInt($("#configTableBody tr .numbersInput:eq(" + i + ")  input:eq(1)").val())
                    })
                }
                tableData[i] = chanceSeeded.n(generateNumber, rowsGenerated);
                console.log("Numbers generated: " + tableData[i].length);
                console.log("Numbers generation complete");
            }
            else if ($("#configTableBody tr .dropdown-toggle:eq(" + i + ")").text() == "Custom ") {
                console.log("Generating custom data set");
                tableData[i] = generateCustomData(i);
                console.log("Custom data set generated");
            }
        }
        console.log("Generate table data: ");
        console.log(tableData);

        $("#generatedTable").html(
                '<table id="resultTable" class="table table-striped" style="display: none;">' +
                '<thead>' +
                '<tr id="tableHeaders">' +
                '</tr>' +
                '</thead>' +
                '<tbody id="resultTableTBody">' +
                '</tbody>' +
                '</table>'
        );

        for (var i=0; i < tableHeaders.length; i++) {
            $("#tableHeaders").append(
                    '<th>' +
                    tableHeaders[i] +
                    '</th>'
            );
        }

        var rowsString = "";
        for (var j=0; j < rowsGenerated;j++) {
            rowsString = rowsString + '<tr>';

            for (var i=0; i < tableData.length; i++) {
                rowsString = rowsString +
                '<td>' +
                tableData[i][j] +
                '</td>';
            }
            rowsString = rowsString + '</tr>';
        }


        // append only inserts fully formed html, hence the string.
        $("#resultTableTBody").append(rowsString);
        $("#resultTable").fadeIn("slow");
    }

    //-- Generates custom column data based off weight distribution
    function generateCustomData(index) {
        var result = [];
        var tableData = customGraphDataList[index];

        var chanceSeeded = new Chance(parseInt($("#randomSeed").val()));

        console.log("Using custom data: ");
        console.log(tableData);

        if (tableData == "") {
            return [];
        }

        //console.log(tableData);
        //console.log("Total entries " + totalEntries);
        //console.log("Max weight " + maxWeightIndex);

        // Sort the list by weight
        tableData.sort(function(a, b) {
            if (b.weight > a.weight) {
                return true;
            } else
                return false;
        });
        console.log(tableData);

        // Add data to result array.  Each sweep down list reduces the weight value by 1.
        // If the weight value reaches zero, no more of that data is added until all weight values
        // Reaches zero.  After of which the weight values are restored and the process begins again
        // until the the number of generated rows is reached.
        //var currentWeightValue = tableData.slice();
        var currentWeightValue = jQuery.extend(true, {}, tableData);
        result = [];
        if (tableData) {

            var totalWeight = 0;
            var maxCountIndex = 0;
            for(index in tableData) {
                totalWeight = totalWeight + tableData[index].weight;
                if (tableData[index].weight > maxCountIndex) {
                    maxCountIndex = tableData[index].weight;
                }
            }

            var countIndex = maxCountIndex;
            var result = [];
            var tableDataIndex = 0;
            var totalGeneratedValues = $("#numberGenerated").val();
            while (result.length < totalGeneratedValues) {
                if (tableData[tableDataIndex].weight >= countIndex) {
                    result.push(tableData[tableDataIndex].data);
                }
                tableDataIndex++;
                if (tableDataIndex >= tableData.length) {
                    tableDataIndex = 0;
                    countIndex--;
                    if (countIndex == 0) {
                        countIndex = maxCountIndex;
                    }
                }
            }

            //console.log(tableData);
            console.log("Custom data generated:");
            console.log(result);

            // Randomize order
            for (index in result) {
                var swapIndex = chanceSeeded.integer({min: 0, max: (result.length - 1)});
                var tempValue = result[index];
                result[index] = result[swapIndex];
                result[swapIndex] = tempValue;
            }

            //console.log(result);

        }

        return (result);

    }

    //-- Runs the Javascript after the webpage is ready to be used
    $(document).ready(function () {

        //-- Exports table data (no headers) into a CSV file
        function exportTableToCSV($table, filename) {

            var $rows = $table.find('tr:has(td)'),

            // Temporary delimiter characters unlikely to be typed by keyboard
            // This is to avoid accidentally splitting the actual contents
                    tmpColDelim = String.fromCharCode(11), // vertical tab character
                    tmpRowDelim = String.fromCharCode(0), // null character

            // actual delimiter characters for CSV format
                    colDelim = '","',
                    rowDelim = '"\r\n"',

            // Grab text from table into CSV formatted string
                    csv = '"' + $rows.map(function (i, row) {
                                var $row = $(row),
                                        $cols = $row.find('td');
                                console.log("Number of columns: " + $cols.length);

                                return $cols.map(function (j, col) {
                                    var $col = $(col),
                                            text = $col.text();
                                    console.log(text);

                                    //if (j == 0) { return null };
                                    return text.replace('"', '""'); // escape double quotes

                                }).get().join(tmpColDelim);


                            }).get().join(tmpRowDelim)
                                    .split(tmpRowDelim).join(rowDelim)
                                    .split(tmpColDelim).join(colDelim) + '"',

            // Data URI
                    csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);
            console.log("CSV: " + csv);

            $(this)
                    .attr({
                        'download': filename,
                        'href': csvData,
                        'target': '_blank'
                    });

            console.log("Exported Rows: " + $rows.length);
        }

        //-- Links hyperlink to export function
        // This must be a hyperlink
        $(".export").on('click', function (event) {
            // CSV
            exportTableToCSV.apply(this, [$('#resultTable'), 'rdg_export.csv']);

            // IF CSV, don't do event.preventDefault() or return false
            // We actually need this to be a typical hyperlink
        });
    });

    //-- Makes the table rows rearrangeable
    $(function() {
        $( "#configTableBody" ).sortable({
            placeholder: "ui-state-highlight",
            //items: 'tr',
            update: function (event, ui) {
                $('#configTableBody > tr > .order').each(function (index) {
                    $(this).text(index + 1);
                });
            }
        });
        $( "#configTableBody" ).disableSelection();
    });

    //-- Makes the table columns rearrangable
    //$('#configTable').dragtable();

    //-- Adds new row to the custom column editor
    function addNewRow() {
        $('#configTableBody').append(
                '<tr class="edit-table-item" style="width: 100%; display: none">' +
                '<td class="order" style="text-align: center">0</td>' +
                '<td>' +
                '<input class="form-control columnTitle" type="text" style="width: 200px"/></td>' +
                '</td>' +
                '<td>' +
                '<!-- Single button -->' +
                '<div class="btn-group">' +
                '<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" onclick="selectDataType(this)" style="width:100px">' +
                'Data Type <span class="caret"></span>' +
                '</button>' +
                '<ul class="dropdown-menu" role="menu">' +
                '<li><a href="#">Name</a></li>' +
                '<li><a href="#">Address</a></li>' +
                '<li><a href="#">State</a></li>' +
                '<li><a href="#">Zip Code</a></li>' +
                '<li><a href="#">Phone</a></li>' +
                '<li><a href="#">SSN</a></li>' +
                '<li><a href="#">Gender</a></li>' +
                '<li><a href="#">Date</a></li>' +
                '<li class="divider"></li>' +
                '<li><a href="#">Number</a></li>' +
                '<li class="divider"></li>' +
                '<li><a href="#">Custom</a></li>' +
                '</ul>' +
                '</div>' +
                '</td>' +
                '<td class="deleteButtonContainer">' +
                '<button type="button" class="btn btn-default" onclick="deleteRow(this)">' +
                '<span class="glyphicon glyphicon-remove"></span>' +
                '</button>' +
                '</td>' +
                '<td class="deleteButtonContainer">' +
                '<button class="btn btn-default customButton" onclick="loadGraphPage($(this).parent().parent().children().first().text())" style="display:none;">Edit</button>' +
                '<div class="numbersInput" style="display:none">' +
                '<div class="input-group">' +
                '<span class="input-group-addon" style="width: 60px">Min</span>' +
                '<input type="number" class="form-control min" style="width: 60px" value="1">' +
                '</div>' +
                '<div class="input-group" style="padding-top: 10px">' +
                '<span class="input-group-addon" style="width: 60px">Max</span>' +
                '<input type="number" class="form-control max" style="width: 60px" value="10">' +
                '</div>' +
                '</div>' +
                '</td>' +
                '</tr>'
        )
        $('#configTableBody > tr > .order').each(function (index) {
            $(this).text(index + 1);
        });

        $('#configTableBody').children().last().show("slow");

        // Add default custom data generator
        customGraphDataList.push($.extend(true, [], customDefaultData));
        customGraphPoints.push([{
                    xCoords: 1,
                    yCoords: 0,
                    name: "Start"
                },
                {
                    xCoords: 25,
                    yCoords: 40,
                    name: "A"
                },
                {
                    xCoords: 50,
                    yCoords: 0,
                    name: "End"
                }]);
        customGraphSettings.push({
            interval: 1,
            line: false
            });
    }

    //-- Delete row from front page config table
    function deleteRow(object) {

        var index = $(object).parent().parent().children().first().text();
        console.log("Removing order number " + index);
        customGraphDataList.splice(index - 1, 1);
        customGraphPoints.splice(index - 1, 1);
        customGraphSettings.splice(index - 1, 1);

        console.log("Config table now has " + customGraphDataList.length + " rows");



        // Fade out and remove row on config table
        $(object).parent().parent().fadeOut("slow", function() {
            $(object).parent().parent().remove();

            // Update order number
            $('#configTableBody > tr > .order').each(function (index) {
                $(this).text(index + 1);
            });
        });
    }

</script>



<script>
    // Section: graph page code
    // These functions are for the graph page

    var returnIndex;  // Index of column where values are returned

    //-- Returns to config page from graph page.  Also used by a button.
    function loadConfigPage() {

        // Save the custom data

        var customGraphData = [];
        var numOfGraphRows = $('#sourceList').find("table").length;
        console.log("Total Rows Saved: " + numOfGraphRows);
        var listOfGraphRows = $('#sourceList').find("table");
        listOfGraphRows.each(function(index) {
            customGraphData.push({
                data: $(this).find("td").first().text(),
                weight: $(this).find("div.btn").text()
            });
        });

        customGraphDataList[customGraphDataIndex] = customGraphData;
        console.log("Custom data object: ");
        console.log(customGraphDataList[customGraphDataIndex]);

        // Save the graph points

        customGraphPoints[returnIndex] = [];

        for (var i=0; i < pointsArray.length; i++) {
            customGraphPoints[returnIndex].push({
                xCoords: pointsArray[i].X(),
                yCoords: pointsArray[i].Y(),
                name: pointsArray[i].name
            });
        }

        // Clear graph
        if (lineList != []) {
            // Remove line graph
            for (arrayIndex in lineList) {
                board.removeObject(lineList[arrayIndex]);
            }
        }
        board.removeObject(c);
        for (arrayIndex in pointsArray) {
            board.removeObject(pointsArray[arrayIndex]);
        }

        // Save the graph settings

        if ($('.myCheckbox').is(':checked')) {
            customGraphSettings[returnIndex].line = true;
        } else {
            customGraphSettings[returnIndex].line = false
        }

        customGraphSettings[returnIndex].interval =
                $("#interval").val();




        // Fade in to next page
        $('#editSourceData').fadeOut(500,'linear', function() {$('#configPage').fadeIn(500)});

    }

    //-- Updates the dropdown menu label and column name to the selection for the custom column
    function selectGraphDataType(object) {
        //console.log($(object).next().prop("tagName"));
        $(object).next().on('click', 'li a', function(){

            $(object).html($(this).text() + ' <span class="caret">');
            //$(object).parent().parent().prev().find("input").val($(this).text());

            if ($("#graphDataType").text() == "Numbers ") {
                //console.log("Showing numbers menu");
                $("#numbersPanel").show("slow");
                updateNumberCurve();
            } else { //if ($("#numbersPanel").css("visibility") == "visible") {
                //console.log("Closing numbers menu");
                $("#numbersPanel").hide("slow");
                if (typeof nc != "undefined") {
                    board.removeObject(nc);
                }
            }
        });

    }

    //-- Clears the previous list when setting
    function setGraphEntries() {
        $('#sourceList').fadeOut("fast", function () {
            $('#sourceList').html("");
            addGraphEntries();
            $('#sourceList').fadeIn("fast");
        });
    }

    //-- Adds data rows equal the number specified in the menu
    function addGraphEntries() {

        var count;
        var numberOfRowsToAdd = $("#numberOfRowsToAdd").val();

        var rowData = [];
        // Generate data from drop down box selection
        console.log("Selection detected: " +$("#graphDataType").text());
        if ($("#graphDataType").text() == "Blank ") {
            for (count = 0; count < numberOfRowsToAdd; count++) {
                rowData.push("");
            }
        }
        else if ($("#graphDataType").text() == "Name ") {
            rowData = chance.unique(chance.name, numberOfRowsToAdd);
            rowData.sort();
        }
        else if ($("#graphDataType").text() == "Address ") {
            rowData = chance.unique(chance.address, numberOfRowsToAdd);
            rowData.sort();
        }
        else if ($("#graphDataType").text() == "State ") {
            if (numberOfRowsToAdd > 51) {
                alert("There are only 51 unique states available.");
                return;
            } else {
                rowData = chance.unique(chance.state, numberOfRowsToAdd);
                rowData.sort();
            }
        }
        else if ($("#graphDataType").text() == "Zip Code ") {
            rowData = chance.unique(chance.zip, numberOfRowsToAdd);
            rowData.sort();
        }
        else if ($("#graphDataType").text() == "Phone ") {
            rowData = chance.unique(chance.phone, numberOfRowsToAdd);
            rowData.sort();
        }
        else if ($("#graphDataType").text() == "SSN ") {
            rowData = chance.unique(chance.ssn, numberOfRowsToAdd);
            rowData.sort();
        }
        else if ($("#graphDataType").text() == "Gender ") {
            if (numberOfRowsToAdd > 2) {
                alert("There are only 2 unique genders available.");
                return;
            } else {
                rowData = chance.unique(chance.gender, numberOfRowsToAdd);
            }
        }
        else if ($("#graphDataType").text() == "Date ") {
            function dateString() {
                return chance.date({string: true});
            }
            rowData = chance.unique(dateString, numberOfRowsToAdd);
            rowData.sort();
        }
        else if ($("#graphDataType").text() == "Numbers ") {
            console.log("Starting Numbers");
            var numberList = [];
            var step = parseInt($("#step").val());
            var start = parseInt($("#start").val());
            console.log("Step " + step + " Start " + start);
            for (count = start; count < start + parseInt(numberOfRowsToAdd * step); count = count + step) {
                var x = count;
                console.log("Number result: " + count);
                numberList.push(eval($("#function").val()));
            }
            console.log("Numbers list:");
            console.log(numberList);
            rowData = numberList;
        }

        console.log("Columns found: " + rowData.length);

        // Add generated data to the custom list
        for (count = 0; count < numberOfRowsToAdd; count++) {
            $('#sourceList').append(
                    '<table  style="width: 100%;" class="list-group-item">' +
                    '<tr style="width: 100%">' +
                    '<td class="list-group-td" contenteditable="true">' +
                    rowData[count] +
                    '</td>' +
                    '<td class="weight-td">' +
                    '<div type="text" class="btn btn-default" contenteditable="true" >' +
                    '1' +
                    '</div>' +
                    '</td>' +
                    '<td class="deleteButtonContainer">' +
                    '<button type="button" class="btn btn-default" onclick="deleteGraphEntry(this)">' +
                    '<span class="glyphicon glyphicon-remove"></span>' +
                    '</button>' +
                    '</td>' +
                    '</tr>' +
                    '</table>'
            );
            $('#sourceList').children().last().hide();
            $('#sourceList').children().last().slideDown("fast");
        }
    }

    //-- Deletes an entry in the custom data page
    function deleteGraphEntry(object) {
        $(object).parent().parent().parent().parent().slideUp("fast", function() {
            $(object).parent().parent().parent().parent().remove();
        })
    }

    //-- Imports data from CSV into custom column editor.
    function importData() {
        console.log("Starting import");
        var fileInput = document.getElementById('fileItem').files[0];
        var importResults = Papa.parse(fileInput, {
            complete: function(importResults) {
                console.log(importResults.data[0].length);

                $('#sourceList').html("");
                var count;
                var numberOfRowsToAdd = importResults.data[0].length;
                console.log("Numbers of rows imported: " + numberOfRowsToAdd);
                for (count = 0; count < numberOfRowsToAdd; count++) {

                    $('#sourceList').append(
                            '<table style="width: 100%;" class="list-group-item">' +
                            '<tr style="width: 100%">' +
                            '<td class="list-group-td" contenteditable="true">' +
                            importResults.data[0][count] +
                            '</td>' +
                            '<td class="weight-td">' +
                            '<div type="text" class="btn btn-default" contenteditable="true" >' +
                            '1' +
                            '</div>' +
                            '</td>' +
                            '<td class="deleteButtonContainer">' +
                            '<button type="button" class="btn btn-default" onclick="$(this).parent().parent().parent().parent().remove();">' +
                            '<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>' +
                            '</button>' +
                            '</td>' +
                            '</tr>' +
                            '</table>'
                    )
                }
            }
        });
        $('#fileItem').val("");

    }

    //-- This display the help menu

    //$('#question').tooltip({animation:"true"});
    $(document).ready(function(){
        console.log("tooltip initializing");
        $('[data-toggle="tooltip"]').tooltip(
                {
                    animation:"true",
                    html: "true",
                    title:"Function takes any javascript expression " +
                            "where x is the value set by starting at the Start number " +
                            "and increasing by step until the number of rows " +
                            "has been reached.<br>" +
                    "Examples include (2*x) + 3/1 - 0<br>" +
                    "and Math.pow(3,4) for 3 to the fourth power<br>",
                    placement:"top"
                }
        );
    });

    //-- Updates the curve on the graph from the function in Number data type
    function updateNumberCurve() {
        if (typeof nc != "undefined") {
            board.removeObject(nc);
        }
        console.log("Creating curve " + $("#function").val().replace("x", "t"));
        nc = board.create('curve',
                [function(t){return t;},
                    function(t){ return eval($("#function").val().replace("x", "t"));},
                    $("#start").val(), parseInt($("#start").val()) + parseInt($("#step").val() * $("#numberOfRowsToAdd").val())], {strokeColor:'green'});
    }

    //-- Check to see if the data type is Numbers before drawing function curve
    function checkNumberCurve() {
        if ($("#graphDataType").text() == "Numbers ") {
            updateNumberCurve();
        }
    }

</script>

<script type="text/javascript">
    // Section: JXGGraph code
    // These functions are for the graph (JXGGraph library).
    // Tutorial: JXGGraph examples from http://jsxgraph.uni-bayreuth.de/wp/documentation/
    // and examples from library from http://www.onemathematicalcat.org/JSXGraphDocs/JSXGraphDocs.htm#alphaList

    var board = JXG.JSXGraph.initBoard('box', {boundingbox: [-15, 80, 80, -15], axis:false});

    // Create custom axis
    var xaxis = board.create('axis', [[-1000, 0], [1000,0]],
            {
                name:'row',
                withLabel: true,
                label: {position: 'top',  // possible values are 'lft', 'rt', 'top', 'bot'
                    offset: [200, 20]   // (in pixels)
                }
            });
    var yaxis = board.create('axis', [[0, -1000], [0, 1000]],
            {
                name:'weight',
                withLabel: true,
                label: {
                    position: 'rt',  // possible values are 'lft', 'rt', 'top', 'bot'
                    offset: [30, -20]   // (in pixels)
                }
            });

    // Create initial points
    // Update: points are now loaded in upon clicking the Custom button


    var pointsArray;
    var lineList = [];

    var c; // Curve object on graph

    var nc; // Number curve on graph

    // Toggle between curve and line graph
    function switchGraph() {
        console.log("Switching graph");

        if (!$('.myCheckbox').is(':checked')) {
            if (lineList != []) {
                // Remove line graph
                for (arrayIndex in lineList) {
                    board.removeObject(lineList[arrayIndex]);
                }
            }

            // Draw curve graph
            c = board.create('curve', JXG.Math.Numerics.CatmullRomSpline(pointsArray), {strokeWidth: 3});
        } else {
            // Remove and draw curve graph
            board.removeObject(c);

            lineList = [];
            // Draw line graph
            for (arrayIndex in pointsArray) {
                if ((parseInt(arrayIndex) + 1) == pointsArray.length) {
                    break;
                }
                var line = board.create('line', [pointsArray[parseInt(arrayIndex)], pointsArray[parseInt(arrayIndex) + 1]], {
                    straightFirst: false,
                    straightLast: false,
                    strokeWidth: 2
                });
                lineList.push(line);
            }
        }
    }

    // Calculate and set the weights based off the graph. X = rows, Y = weight.
    function setWeightCurveFromGraph() {
        var sampleX = [];
        for (var i=parseInt(pointsArray[0].X()); i <= parseInt(pointsArray[pointsArray.length-1].X()); i=i+parseInt($("#interval").val())) {
            //console.log(i);
            sampleX.push(i);
        }
        console.log("Intervals : ");
        console.log(sampleX);

        var newList = [];
        var curveCoords = [];
        var curveX, curveY;

        // Trace points along lines at set intervals
        if ($('.myCheckbox').is(':checked')) {
            for (i in sampleX) {
                var sampleIndex = i;

                for (j in pointsArray) {
                    var pointIndex = parseInt(j);

                    // Exit on last point
                    if ((pointIndex + 1) == pointsArray.length) {
                        break;
                    }

                    // Obtain coordinate point on line
                    if (sampleX[sampleIndex] >= pointsArray[pointIndex].X() &&
                            sampleX[sampleIndex] <= pointsArray[pointIndex + 1].X()) {
                        curveX = sampleX[sampleIndex];
                        var rise = pointsArray[pointIndex + 1].Y() - pointsArray[pointIndex].Y();
                        var run = pointsArray[pointIndex + 1].X() - pointsArray[pointIndex].X();
                        var offset = sampleX[sampleIndex] - pointsArray[pointIndex].X();
                        curveY = Math.round((rise/run)*offset + pointsArray[pointIndex].Y());
                        newList.push({entry: curveX, weight: curveY});
                        break;
                    }

                }

            }

        } else {
            // Trace points along curve at set intervals
            //console.log("Setting up curve path coordinates : ");
            for (var i = 0; i < 4; i = i + 0.001) {
                curveX = eval(c.X);
                curveY = eval(c.Y);
                curveCoords.push({x: curveX(i, 0.5), y: curveY(i, 0.5)});
            }

            console.log("Curve done:");
            console.log(curveCoords);

            // Find closest interval points to the curve points
            var interval = parseInt($("#interval").val());
            var prevPointX = pointsArray[0].X();
            var dist = 0;
            newList.push({entry: Math.round(curveCoords[0].x), weight: Math.round(curveCoords[0].y)});
            for (var i = 0; i < curveCoords.length; i = i + 1) {
                dist = Math.abs(curveCoords[i].x - prevPointX);
                //console.log("Checking point " + curveCoords[i].x + " found distance " + dist + " from prev point " + prevPointX);
                if (dist >= interval) {
                    newList.push({entry: Math.round(curveCoords[i].x), weight: Math.round(curveCoords[i].y)});
                    prevPointX = prevPointX + interval;
                }
            }
        }

        // Display new list for debugging.
        console.log("New list :");
        var tempArray = [];
        for (index in newList) {
            tempArray.push(newList[index].weight);
        }
        console.log(tempArray);

        //$('#sourceList').html("");

        // Update data table with new weights
        var count;
        var numberOfRowsToAdd = newList.length;
        console.log("Numbers of rows that can be set: " + numberOfRowsToAdd);
        console.log("Number of current rows: "  + $("#sourceList > table").length);
        for (count = 0; count < $("#sourceList").children().length; count++) {
            for (curveLinePoint in newList) {
                //console.log("Checking value " + Math.abs(count - newList[parseInt(curveLinePoint)].entry));
                if (Math.abs((count + 1) - newList[parseInt(curveLinePoint)].entry) <= 0.5) {
                    //console.log(count);
                    //console.log($("#sourceList table").eq(count).prop("tagName"));
                    //console.log($("#sourceList table").eq(count).children().first().children().first().children().first().next().prop("tagName"));
                    // The next line overwrite the data with X values
                    //$("#sourceList table").eq(count).children().first().children().first().children().first().text(newList[count].entry);
                    $("#sourceList table").eq(count).children().first().children().first().children().first().next().children().first().text(newList[parseInt(curveLinePoint)].weight);
                    break;
                }
            }
        }
    }

    // Add, delete points on graph using mouse clicks
    // From http://jsxgraph.uni-bayreuth.de/wiki/index.php/Browser_event_and_coordinates
    var deletePoint = false;
    var getMouseCoords = function(e, i) {
        var eachPoint;
        var cPos = board.getCoordsTopLeftCorner(e, i),
                absPos = JXG.getPosition(e, i),
                dx = absPos[0]-cPos[0],
                dy = absPos[1]-cPos[1];

        return new JXG.Coords(JXG.COORDS_BY_SCREEN, [dx, dy], board);
    };
    var up = function(e) {
        console.log("Mouse up");

        var canCreate = true, i, coords, el;

        if (e[JXG.touchProperty]) {
            // index of the finger that is used to extract the coordinates
            i = 0;
        }
        coords = getMouseCoords(e, i);

        // Do not delete or add if mouse was moved
        console.log(xMouse + "," + yMouse);
        if ((xMouse != coords.scrCoords[1]) || (yMouse != coords.scrCoords[2])) {
            return;
        }

        // Delete point clicked on
        for (el in board.objects) {
            //console.log("Name: " + JXG.getRef(board, board.objects[el]).name);

            // Check to see if the place clicked has a point
            if(JXG.isPoint(board.objects[el]) && board.objects[el].hasPoint(coords.scrCoords[1], coords.scrCoords[2])) {

                //console.log("Name of Point: " + JXG.getRef(board, board.objects[el]).name);
                canCreate = false;


                if (board.objects[el].name == "Start" || board.objects[el].name == "End") {
                    break;
                }

                if (!$('.myCheckbox').is(':checked')) {
                    // Remove the point clicked on and recreate the curve
                    board.removeObject(c);
                } else {
                    // Remove line graph
                    for (arrayIndex in lineList) {
                        board.removeObject(lineList[arrayIndex]);
                    }
                    lineList = [];
                }
                board.removeObject(board.objects[el]);


                for (arrayIndex in pointsArray) {
                    //console.log("Checking point from pointsArray :" + arrayIndex);
                    if (pointsArray[arrayIndex].hasPoint(coords.scrCoords[1], coords.scrCoords[2])) {
                        //console.log("Removing point index from pointsArray: " + arrayIndex);
                        pointsArray.splice(arrayIndex, 1);
                        break;
                    }
                }

                if (!$('.myCheckbox').is(':checked')) {
                    c = board.create('curve', JXG.Math.Numerics.CatmullRomSpline(pointsArray), {strokeWidth: 3});
                } else {
                    // Draw line graph
                    for (arrayIndex in pointsArray) {
                        if ((parseInt(arrayIndex) + 1) == pointsArray.length) {
                            break;
                        }
                        var line = board.create('line', [pointsArray[parseInt(arrayIndex)], pointsArray[parseInt(arrayIndex) + 1]], {straightFirst:false, straightLast:false, strokeWidth:2});
                        lineList.push(line);
                    }
                }
                break;
            }
        }

        // Create new point
        if (canCreate) {
            var insertIndex = 1;

            // Coords attribute obtained from http://jsfiddle.net/migerh/PgC3m/
            for (arrayIndex in pointsArray) {
                //console.log ("Index/x-coord: " + arrayIndex + "/" + pointsArray[arrayIndex].coords.usrCoords[1]);
                if (coords.usrCoords[1] > pointsArray[arrayIndex].coords.usrCoords[1]) {
                    insertIndex = parseInt(arrayIndex) + 1;
                }
                console.log("Insert index: " + insertIndex);
            }
            if (insertIndex >= pointsArray.length) {
                insertIndex = pointsArray.length - 1;
            }

            pointsArray.splice(insertIndex, 0, board.create('point', [coords.usrCoords[1], coords.usrCoords[2]], {
                size: 4,
                snapToGrid: true
            }));


            // Draw new line or curve
            if (!$('.myCheckbox').is(':checked')) {
                console.log("Updating curve");
                // Remove and draw curve graph
                board.removeObject(c);
                c = board.create('curve', JXG.Math.Numerics.CatmullRomSpline(pointsArray), {strokeWidth: 3});
            } else {
                console.log("Updating line");
                // Remove line graph
                for (arrayIndex in lineList) {
                    board.removeObject(lineList[arrayIndex]);
                }
                lineList = [];
                // Draw line graph
                for (arrayIndex in pointsArray) {
                    if ((parseInt(arrayIndex) + 1) == pointsArray.length) {
                        break;
                    }
                    var line = board.create('line', [pointsArray[parseInt(arrayIndex)], pointsArray[parseInt(arrayIndex) + 1]], {
                        straightFirst: false,
                        straightLast: false,
                        strokeWidth: 2
                    });
                    lineList.push(line);
                }
            }

        }
    };

    var xMouse, yMouse;
    var down = function(e) {

        var i, coords, el;

        console.log("Clicking mouse");

        if (e[JXG.touchProperty]) {
            // index of the finger that is used to extract the coordinates
            i = 0;
        }
        coords = getMouseCoords(e, i);

        xMouse = coords.scrCoords[1];
        yMouse = coords.scrCoords[2];
        console.log("Mouse coords:" + xMouse + "," + yMouse);

    }

    // Assign mouse/touch events
    board.on('down', down);
    board.on('up', up);

</script>

</body>
</html>